# FTMW_Binary_reader

## Overview
This Python3 tool allows you to open and analyze multiple .dat files generated by Jens' FTMW++ program, including legacy 'JUG'-type data. It was originally developed for personal use to process data from the PARIS spectrometer, so while the code may be a bit unpolished, it works reliably and efficiently.
Special thanks to D. F. Plusquellic (check out his J95 software ðŸ”—https://www.nist.gov/services-resources/software/jb95-spectral-fitting-program) and J.-U. Grabow for information on the formatting of FTMW++ files.
If there are any problems when running the Python3 script, feel free to contact me under sven_herbers@web.de.
Also check out my other repository 'XIAM-2NQ' (ðŸ”—https://github.com/SvenHerbers/XIAM-2NQ) which is a spectral fitting code with some special capabilities.
## Citation
If you use this tool in your work, please cite it by linking to the GitHub repository:
ðŸ”— https://github.com/SvenHerbers/FTMW_Binary_reader

If your journal requires a formal article citation, please cite the PARIS spectrometer publication, as the software was originally created to analyze its output.
Rev. Sci. Instrum. 96, 054706 (2025)
https://doi.org/10.1063/5.0256434

## Documentation
The documentation is divided into several parts. It begins with an overview of the general setup and GUI, followed by a detailed explanation of all configurable parameters and their functions.

### General information
The program consists of two Python3 files:

    OpenBinary_module_v17102025.py
    A module containing functions for reading and processing the binary files.

    Readscan_and_plotscan_v17102025.py
    The main script that you should run to launch the program.

Make sure both files are located in the same directory. For convenience, you can place them in the same folder as your .dat files to avoid specifying full file paths.

Once the script is launched and the parameters are configured correctly (see section below), the GUI will open and display the Fourier-transformed .dat file(s):
![image](https://github.com/user-attachments/assets/bb8b9d83-68c9-40ff-81ee-64d63a8b8886)


As with most Matplotlib plots, you can zoom in by clicking the magnifying glass icon and dragging a window over your region of interest.
Other standard navigation tools are also availableâ€”see the Matplotlib Pyplot Tutorial for details.

Notice the fields labeled `Intensity`, `LeftDoppler`, `RightDoppler`, `DopplerSplit`, and `CenterFreq`.

Once a region of interest is selected, you can:

-    Double left-click to mark the left line of a Doppler pair.
-    Double right-click to mark the right line.

or just stay with a single line if your machine does not show Doppler splitting.

After selecting a pair, the field labels are replaced with the corresponding frequency and intensity values.
To copy a value to your clipboard, simply click on the field.

![image](https://github.com/user-attachments/assets/094891e5-cc9c-422f-a2df-283a23fb1c16)

These are the basic GUI functionalities.
Advanced featuresâ€”such as auto single-peak detection, auto Doppler-pair finding, resonator scan stitching, broadband file merging, window functions, and tail/head cuttingâ€”are described in the following sections.

### Setting up the Readscan_and_plotscan script

To have the script working on your files you have to adjust the first INPUT lines of the script. We will now go through each of the parameters:

```
##### INPUT

label    = "FileLabel_" # Label before index of filename. e.g. "FileLabel_00040.dat"
startidx =      40      # Starting index (5-digits at end of file names). As example: 40.
endidx   =      40      # Ending index. If single filed set endidx to startidx

masklines=      []      # Lines to remove
maskwidth=      0.1     # +-width (MHz) to mask

forcecalc=      True    # 0 = use existing spectrum, 1 = force recalculation
rangeMHz =      0.5     # +-range (MHz) around probe freq read from binary file; For Resonator: ~HWHM. For chirps: ~chirp_width/2

##### ADVANCED INPUT

head_cut            = 0         # Head cut (Âµs)
tail_cut            = 0         # Tail cut (Âµs)

Kaiser              = 0.0       # Kaiser window beta; 0 = off (set forcecalc=1 if changing Kaiser parameters)

rebin               = False     # Reduce resolution; 0/False = no rebinning (affects line list accuracy). To be used only to get compact complete spectra, does not work on single filed.
rebinsize           = 0.250

stickspectrum       = False     # Produce stick spectrum (uses stickthreshold)
stickthreshold      = 2.5       # Peakfinder threshold (times global average)
stick_localthresh   = 2.5       # Peakfinder threshold (times local average +-500 points)
stickmaxtest        = 5         # Check +-stickmaxtest points for local maxima. If there are two maxima within this range only the larger one will be chosen.

stick_dopplerread   = False     # Detect Doppler pairs using stick_exampledoppler. stickspectrum must be True as well for this option to be enabled.
stick_exampledoppler= [[ 9736.70304, 0.05451],[18945.27468, 0.10987]] # Two [line, Doppler splitting] pairs to be picked manually from the spectrum.
                                                                       # The script then calculates beam velocity and extrapolate expected splittings for automatic Doppler pair identification.
stick_dopplerthresh = 0.011     # Max MHz difference in expected vs experimental Doppler splitting to match Doppler pairs

rezero              = False     # Subtract noise floor via inverse-squared weighted average - recommended only for stitching broadband data

JUGDATA             = False     # False: load Ftmw++ .dat files from startidx to endidx; True: load JUG single file with startidx and endidx ignored
PowerSpectrum       = False     # Show power spectrum (True) or amplitude spectrum (False)

##### END OF INPUT

```

After setting up these paramters you should be able to simply run the script!
The output files saved are the two column space separated .txt files of the spectrum and of the masked spectrum.
In case stickspectrum was true all found single peaks are saved in a txt file ending with ...STICKS_single.txt
In case stick_doppler read was true all found centre frequencies doppler splittings and intensities are saved in a file ending with ...STICKS_DOPPLER.txt.
It is possible to simply load these files into python3 scripts by using the `np.loadtxt('filename')` function.


## Examples
I recommend to start with one of the examples below, which are preconfigured for applications perhaps similar to yours.
### Example 1: A single resonator .dat file
This spectrum of O13CS is from the PARIS article published in Rev. Sci. Instrum. 96, 054706 (2025)
https://doi.org/10.1063/5.0256434
The range parameter is set to `rangeMHz = 0.5` MHz.
The Readscan_and_plotscan_v09082025.py script loads a single file and creates an amplitude spectrum with no Kaiser window applied by default. To reproduce the article figure, run the script with `Kaiser=10.0` and apply a `tail_cut=400 ` of 400Âµs.
Stick spectrum generation is enabled, while Doppler finder is disabled, producing a file listing individual Doppler components.
The figure shows the resulting plot after running the script. Detected single lines are marked with red bars to help identify any missed lines for manual selection.
The created ...STICKS_single.txt then contains the four lines and their intensities:
```
   1.212382531830416e+04   6.125854074573625e-02
   1.212383055321025e+04   1.092498128914105e-01
   1.212385206974306e+04   5.293214749581831e-02
   1.212385739774715e+04   1.111550013795395e-01
```
<img width="1496" height="785" alt="image" src="https://github.com/user-attachments/assets/a23a750f-94ed-459b-a3dc-6936d3ca0a55" />


### Example 2: A resonator scan - multiple .dat files
Shown here is a section of the 4MPY spectrum, also featured in Fig. 19 of the PARIS article. The range parameter is set to `rangeMHz = 1.0` MHz â€” increasing this value generally improves stitching quality but may reduce signal-to-noise ratio. (Opening single files still gives the best signal-to-noise.)

In this example, startidx and endidx are set to different values. The Doppler line detection routine is activated: by providing the central frequency and Doppler splitting of two reference lines to stick_exampledoppler, the script attempts to identify corresponding Doppler pairs throughout the spectrum. These reference lines can be located anywhere, not necessarily at the spectrumâ€™s start or end. To also find weaker peaks in the spectrum, the threshold parameters were finetuned.

```
stickspectrum       = True      # Produce stick spectrum (uses stickthreshold)
stickthreshold      = 2.0       # Peakfinder threshold (times global average)
stick_localthresh   = 1.0       # Peakfinder threshold (times local average +-500 points)
stickmaxtest        = 5         # Check +-stickmaxtest points for local maxima. If there are two maxima within this range only the larger one will be chosen.

stick_dopplerread   = True     # Detect Doppler pairs using stick_exampledoppler
stick_exampledoppler= [[ 16906.28269,     0.04489],[16906.84839,    0.04588]] # Two [line, Doppler splitting] pairs to be picked manually from the spectrum.
                                                                       # The script then calculates beam velocity and extrapolate expected splittings for automatic Doppler pair identification.
stick_dopplerthresh = 0.011     # Max MHz difference in expected vs experimental Doppler splitting to match Doppler pairs
```

The screenshot shows lines automatically detected by the script, marked with green bars. For each detected Doppler pair, the central frequency intensity and +-Doppler splitting are saved to the STICKS_DOPPLER file:
```
             16906.28339   3.29741e-02       0.04554
             16906.29682   2.90078e-02       0.04436
             16906.71248   1.85092e-01       0.04546
             16906.71767   2.29729e-01       0.04026
             16906.72317   2.74027e-01       0.04575
             16906.84839   3.37883e-01       0.04586
             16906.93670   2.32085e-01       0.04245
             16906.94190   2.46080e-01       0.04765
             16907.02444   1.47592e-01       0.04529
             16907.02964   1.61587e-01       0.04009
             16907.03531   1.68278e-01       0.04575
             16907.05179   1.44006e-01       0.04767
             16907.07131   9.49785e-02       0.04622
             16907.14512   1.56857e-01       0.04566
             16907.18148   8.50342e-02       0.04567
```

Note: Weaker lines at the edges of the hyperfine structure may not be picked up by the automatic peak-finding routine because they are too weak relative to the spectrumâ€™s local or global average. These weaker lines must be selected manually via the GUI: double left-click to mark the left Doppler, double right-click for the right Doppler, and use the respective fields to copy data to the clipboard. It is also possible to attempt to fine tune stickthreshold and stick_localthresh as done in the case of this example.  

<img width="1538" height="788" alt="image" src="https://github.com/user-attachments/assets/a6597de6-78b6-4077-9a55-3bb680f695b6" />



### Example 3: A single 1GHz chirp broadband .dat file
Shown is a broadband spectrum of OCS in Neon, also featured in the PARIS article. The range parameter is set to `rangeMHz = 501.0` MHz for the broadband spectrum, covering slighlty more than 1GHz of data.

Doppler peak finding is enabled. Here, I used the center frequency and Doppler splitting of the main OCS isotopologue twice to improve detectionâ€”using two different lines helps but isnâ€™t strictly necessary.
```
stickspectrum       = True      # Produce stick spectrum (uses stickthreshold)
stickthreshold      = 2.5       # Peakfinder threshold (times global average)
stick_localthresh   = 2.5       # Peakfinder threshold (times local average +-500 points)
stickmaxtest        = 5         # Check +-stickmaxtest points for local maxima. If there are two maxima within this range only the larger one will be chosen.

stick_dopplerread   = True     # Detect Doppler pairs using stick_exampledoppler
stick_exampledoppler= [[ 12162.97859,         0.03269],[ 12162.97859,         0.03269]] # Two [line, Doppler splitting] pairs to be picked manually from the spectrum.
                                                                       # The script then calculates beam velocity and extrapolate expected splittings for automatic Doppler pair identification.
stick_dopplerthresh = 0.011     # Max MHz difference in expected vs experimental Doppler splitting to match Doppler pairs
```

Broadband measurements at PARIS always have a DC artifact, usually at the measurement center. In this case, it appears at 11750, so I added it to the mask list.
```
masklines=      [11750] # Lines to remove
maskwidth=      0.1     # +-width (MHz) to mask
```
<img width="1484" height="781" alt="image" src="https://github.com/user-attachments/assets/2c64e83b-915d-4696-8b7c-4cfa024403e1" />


### Example 4: Multiple 1GHz chirp broadband .dat files
The PARIS broadband experiments typically work in 1 GHz steps, as do the Hannover-IMPACT experiments. This example shows how to stitch such broadband files together using a portion of the 234-Trifluoro-toluene spectrum. (Canadian Journal of Physics 17 October 2019 https://doi.org/10.1139/cjp-2019-0477)

The range parameter is set to `rangeMHz = 501.0` MHz. 
The computation takes longer, and the console will show progress through the files.
If youâ€™ve run the script once and only want to re-plot results, consider setting `forcecalc=False` to skip recalculation.
Notice the many Doppler pairs found!
```
stickspectrum       = True      # Produce stick spectrum (uses stickthreshold)
stickthreshold      = 5.0       # Peakfinder threshold (times global average)
stick_localthresh   = 1.5       # Peakfinder threshold (times local average +-500 points)
stickmaxtest        = 5         # Check +-stickmaxtest points for local maxima. If there are two maxima within this range only the larger one will be chosen.

stick_dopplerread   = True     # Detect Doppler pairs using stick_exampledoppler
stick_exampledoppler= [[ 13341.22734,             0.03578],[  9866.81114,             0.02523]] # Two [line, Doppler splitting] pairs to be picked manually from the spectrum.
                                                                       # The script then calculates beam velocity and extrapolate expected splittings for automatic Doppler pair identification.
stick_dopplerthresh = 0.015     # Max MHz difference in expected vs experimental Doppler splitting to match Doppler pairs
```
<img width="1547" height="784" alt="image" src="https://github.com/user-attachments/assets/942f75b7-bd10-4591-aff6-21ad2bd7bbf7" />

## Version progress
-    v17102025:
     *    Improved intensity interpolation accuracy by approximately 1% (frequencies unaffected).
     *    Updated README and examples
-    v09082025:
     *    Updated README and examples
     *    General code cleanup (removed comments and dead code)
     *    Renamed `Kaiser_Head` and `Kaiser_Tail` to `head_cut` and `tail_cut`
     *    `CompiledSpectrum_MASKED` files are now created only if maskedlines is not empty
     *    Changed local threshold from a fixed 2.5 to user-configurable via `stick_localthresh`.
-    First Uploaded Version: v11072024

