# FTMW_Binary_reader

## Overview
This Python3 tool allows you to open and analyze multiple .dat files generated by Jens' FTMW++ program, including legacy 'JUG'-type data. It was originally developed for personal use to process data from the PARIS spectrometer, so while the code may be a bit unpolished, it works reliably and efficiently.
Special thanks to D. F. Plusquellic (check out his J95 software ðŸ”—https://www.nist.gov/services-resources/software/jb95-spectral-fitting-program) and J.-U. Grabow for information on the formatting of FTMW++ files.
If there are any problems when running the Python3 script, feel free to contact me under sven_herbers@web.de.
Also check out my other repository 'XIAM-2NQ' (ðŸ”—https://github.com/SvenHerbers/XIAM-2NQ) which is a spectral fitting code with some special capabilities.
## Citation
If you use this tool in your work, please cite it by linking to the GitHub repository:
ðŸ”— https://github.com/SvenHerbers/FTMW_Binary_reader

If your journal requires a formal article citation, please cite the PARIS spectrometer publication, as the software was originally created to analyze its output.
Rev. Sci. Instrum. 96, 054706 (2025)
https://doi.org/10.1063/5.0256434

## Documentation
The documentation is divided into several parts. It begins with an overview of the general setup and GUI, followed by a detailed explanation of all configurable parameters and their functions.

### General Information
The program consists of two Python3 files:

    OpenBinary_module_v11072024.py
    A module containing functions for reading and processing the binary files.

    Readscan_and_plotscan_v10072024.py 
    The main script that you should run to launch the program.

Make sure both files are located in the same directory. For convenience, you can place them in the same folder as your .dat files to avoid specifying full file paths.

Once the script is launched and the parameters are configured correctly (see section below), the GUI will open and display the Fourier-transformed .dat file(s):
![image](https://github.com/user-attachments/assets/bb8b9d83-68c9-40ff-81ee-64d63a8b8886)


As with most Matplotlib plots, you can zoom in by clicking the magnifying glass icon and dragging a window over your region of interest.
Other standard navigation tools are also availableâ€”see the Matplotlib Pyplot Tutorial for details.

Notice the fields labeled "Intensity", "LeftDoppler", "RightDoppler", "Dopplersplit", and "CenterFreq".

Once a region of interest is selected, you can:

    -Double left-click to mark the left line of a Doppler pair.

    -Double right-click to mark the right line.

or just stay with a single line if your machine does not show Doppler splitting.

After selecting a pair, the field labels are replaced with the corresponding frequency and intensity values.
To copy a value to your clipboard, simply click on the field.

![image](https://github.com/user-attachments/assets/094891e5-cc9c-422f-a2df-283a23fb1c16)

These are the basic GUI functionalities.
Advanced featuresâ€”such as auto single-peak detection, auto Doppler-pair finding, resonator scan stitching, broadband file merging, window functions, and tail/head cuttingâ€”are described in the following sections.

### Setting up the Readscan_and_plotscan_v10072024.py

To have the script working on your files you have to adjust the first INPUT lines of the script. We will now go through each of the parameters:

```
##### INPUT

label    = "a_"  # This is how your filnames start! can include path information if not in the same folder.
                 # The label is a_ if your files are called 'a_00001.dat' etc

JUGDATA = False     # If False, Ftmw++ .dat file is loaded, if True, fies from older machines, so called JUG files are loaded.

PowerSpectrum = False  #True shows the square of the usual amplitude spectrum, which is preferred by some, but the default is False and the amplitude spectrum is shown.

masklines=[999.9123,12321.0]  # Sometimes you have artifacts or dirt in your measurment that you know of. 
                              # To put a zero-mask over it add the centre of the region into the 'masklines' list.

maskwidth=0.1                 # +-width around centre that will be removed by mask in MHz.

startidx =  1      # Starting index, you can ommit or add the leading zeros, it works either way. the file indices must consist of 5 digits.
                   # A generic name produced by FTMW++ is for example a_00001.dat.

endidx   = 3      # End index
                  # The last index in the set of files you want to analyse. with label = "a_" startidx = 1 and endidx =3 the files that
                  # are expected by the program are a_00001.dat a_00002.dat a_00003.dat. It will load them and stitch them together. 
                  # For a single .dat file set startidx=endidx.

forcecalc= 1      # if zero, the script checks if it already ran once and produced a spectrum file and plots that instead of recalculating.
                  # If 1, recalculation is forced.
                  # This can really save time when you just want to open the previously computed spectrum and not run through all .dat files again.

rangeMHz = 501    # In many cases, especially in resonator measurements, you donâ€™t want to plot the entire FFT spectrum.
                  # Instead, you focus on a specific region around the resonator frequency.
                  # For 1 GHz broadband measurements, a value around +-501 MHz works.
                  # For narrow resonator scans, a value close to the resonatorâ€™s FWHM (~1.0 MHz) is usually sufficient.
                  # If the mode drifts during the scan, consider increasing this value.
                  # Similarly, if stitching artifacts (intensity jumps) appear, increasing this range can help mitigate them.

##### ADVANCED INPUT
                     # If you change these parameters, you might want to set forcecalc=1 to overwrite previous run.
Kaiser = 4.          # application of a kaiserwindow with kaiserparameter Kaiser=beta. If zero, no kaiserwindow is used. 
Kaiser_Tail= 0       # tailcut applied in mus
Kaiser_Head = 0      # Headcut applied in mus
rebin = False        # In case you want to reduce resolution and make a small low resolution plot, you can do so with this rebin option
                     # rebin = False omits rebinning.
rebinsize = 0.250    # this would use 250 kHz bins if rebin was True.
stickspectrum = True        # This will produce a linelist based on peaks the script finds. The found peaks are highlighted as red bars in the GUI. It is really limited to onl finding strong lines.
stick_dopplerread = False   # if this is turned on an approach is made to find doppler pairs based on stick_exampledoppler. Found doppler pairs are green the GUI.
                            # The output files of stickspectrum and stick_dopplerread are both saved together with the spectrum and masked spectrum as .txt files in the folder of the data.
                            # The script also prints the expected velocity of the jet in m/s based on this doppler splittings into the console.
##### END OF INPUT


######## Advanced control parameters 
rezero = False         # substract noisefloor by the inverse squared value weighted average of each section. Should not be used for stitching resonator data, but can be helpful when stitching broadband data.
stickthreshold = 2.5   # threshold in terms of global spectrum, reduce to perhaps find more lines. local threshold hardwired to 2.5 for three datapoints at and around maximum.
stickmaxtest = 5       # checks for every point, stickmaxtest left and right of it, if it is the largest, it is identified as a local maximum and subjected to interpolation

stick_exampledoppler = [[ 9736.70304,            0.05451],[18945.27468,        0.10987]] # SET FOR Helium
                           # This is used to setup the automatic dopplerfinding. Add one centre frequency and its +- Doppler splittin line at the start of the spectrum, and one from the end
stick_dopplerthresh = 0.015# SET FOR Helium: defines how precise in MHz the doppler must be to identify a pair - depends on how much fine structure you have but 15 kHz should be fine in most cases
# exponential window not tested:
exponentialwindow=ew = 0 # exponentialwindow parameter , 0 deactivates it
```

After setting up these paramters you should be able to simply run the script!
The output files saved are the two column space separated .txt files of the spectrum and of the masked spectrum.
In case stickspectrum was true all found single peaks are saved in a txt file ending with ...STICKS_single.txt
In case stick_doppler read was true all found centre frequencies doppler splittings and intensities are saved in a file ending with ...STICKS_DOPPLER.txt.
It is possible to simply load these files into python3 scripts by using the np.loadtxt('filename') function.


## Examples
It might be best to start with one of the examples below, already set up, perhaps, for a similar application as you are intending to use it
### Example 1: A single Resonator .dat file
Shown in the spectrum of O13CS used in the PARIS article in Rev. Sci. Instrum. 96, 054706 (2025)
https://doi.org/10.1063/5.0256434
The range parameter is set to **0.5 MHz**
The Readscan_and_plotscan_v10072024.py is set up to open a single file as amplitude spectrum. No Kaiser window applied. To repduce the article figure run the script with Kaiser=10.0!
stickspectrum and doppler finder are deactivated
![image](https://github.com/user-attachments/assets/2ee1daf2-66fa-4d4f-9d8b-48e4e37e7876)

### Example 2: A resonator Scan - multiple .dat files
update 20.06.2025 : increased range parameter and updated readme descritpion a little.
update 23.06.2025 : changed rezero to False, it should not be used with resonator scans.

Shown here is a section of the 4MPY spectrum, also featured in Fig. 19 of the PARIS article. The range parameter is set to 1.0 MHz â€” increasing this value generally improves the stitching quality, though at the expense of signal-to-noise ratio (opening single flies will still give you the best signal-to-noise).

In this example, startidx and endidx are set to different values. The Doppler line detection routine is also activated: by providing the central frequency and the Doppler splitting of two lines to the stick_exampledoppler script, the script attempts to identify corresponding Doppler pairs. These reference lines do not really need to be located at the spectrumâ€™s start or end - they can be located anywhere.

The screenshot shows the lines that were automatically detected by the script marked with green bars. For each detected Doppler pair, the central frequency and other relevant data are saved to the STICKS_DOPPLER file.

Note: The weaker lines at the ends of the hyperfine structure are not picked up by the automatic peak-finding routine, as they are too weak relative to the average rest of the spectrum, which can happen even for stronger lines if only dense small sections of a spectrum are measured. These weaker lines must be selected manually by the user via the GUI (double left-click to mark left Doppler, double right-click to mark right Doppler, and use the respective fields to copy data to the clipboard). 
![image](https://github.com/user-attachments/assets/dba070ee-3f4f-49ba-9631-0fd8300a6344)


### Example 3: A single 1GHz chirp broadband .dat file
Shown is a broadband spectrum of OCS in Neon also shown in the PARIS article.
The range parameter is set to **501 MHz**
Again run with doppler peak finding, this time I simply entered two times the centre frequency and dopplerspliting of the main isotopologue of OCS, because 2 different lines are just to improve things, but not strictly required.
For the broadband measurments at PARIS there is always the DC-artifact, by default at the centre of the measurment. in this case it lies at 11750, so I added it to the mask list!

![image](https://github.com/user-attachments/assets/8d914a19-44e0-4720-93e0-63027c9a1c4f)

### Example 4: Multiple 1GHz chirp broadband .dat files
The PARIS broadband experiments works in 1GHz steps. So do the Hannover-IMPACT experiments it is possible to stitch them together shown here on the example of a portion of the 234-Tri-fluoro-toluene spectrum. (Canadian Journal of Physics 17 October 2019 https://doi.org/10.1139/cjp-2019-0477)

The range parameter is set to **501 MHz** 
The computation takes a bit longer, and you will the in the console how it runs through the files. This is one of the cases where you might consider setting forcecalc=0 in case you ran the script ones and just want to plot things again.
Notice the plethora of found doppler pairs - it was a joy to fit those (though back in the days I didnt have a peak finder script yet!):

![image](https://github.com/user-attachments/assets/545aa085-3b4e-49b4-853c-9b691f23704e)

## Version progress
... I will write things here if something new comes up. For now this is the 10.07.2024 version of readscan running with the 11.07.2024 version of the module.

